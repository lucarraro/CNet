<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rivnet">
<title>traudem • rivnet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="traudem">
<meta property="og:description" content="rivnet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rivnet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/traudem.html">traudem</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>traudem</h1>
            
      
      
      <div class="d-none name"><code>traudem.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lucarraro.github.io/traudem/" class="external-link">traudem</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="scope-of-traudem">Scope of traudem<a class="anchor" aria-label="anchor" href="#scope-of-traudem"></a>
</h2>
<div class="section level3">
<h3 id="what-this-package-does">What this package does<a class="anchor" aria-label="anchor" href="#what-this-package-does"></a>
</h3>
<ul>
<li>It provides a guide to installation of TauDEM and its dependencies
GDAL and MPI, depending on your operating system.</li>
<li>It checks that TauDEM and its dependencies are correctly installed
and included to the PATH.</li>
<li>It provides wrapper commands for calling TauDEM methods from R.</li>
</ul>
</div>
<div class="section level3">
<h3 id="what-this-package-does-not">What this package does not<a class="anchor" aria-label="anchor" href="#what-this-package-does-not"></a>
</h3>
<ul>
<li>It does not provide an automatic installation of TauDEM and its
dependencies. Please refer to the
<code><a href="https://lucarraro.github.io/traudem/articles/taudem-installation.html" class="external-link">vignette("taudem-installation")</a></code> for instructions on
this.</li>
<li>It does not provide extensive documentation on the functioning of
TauDEM commands. Please refer to the <a href="https://hydrology.usu.edu/taudem/taudem5/index.html" class="external-link">original
TauDEM documentation</a> for that.</li>
</ul>
</div>
<div class="section level3">
<h3 id="can-traudem-run-all-taudem-methods">Can traudem run all TauDEM methods?<a class="anchor" aria-label="anchor" href="#can-traudem-run-all-taudem-methods"></a>
</h3>
<p>Yes! Some TauDEM methods have dedicated wrappers like
<code><a href="https://lucarraro.github.io/traudem/reference/taudem_pitremove.html" class="external-link">taudem_pitremove()</a></code>, with argument names that we strove to
make informative. For other methods, you can use
<code><a href="https://lucarraro.github.io/traudem/reference/taudem_exec.html" class="external-link">taudem_exec()</a></code> and provide the arguments as TauDEM CLI would
expect them. You could make a PR to this repository to add more
dedicated wrappers.</p>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Refer to <a href="https://lucarraro.github.io/traudem/articles/taudem-installation.html" class="external-link"><code>vignette("taudem-installation", package = "traudem")</code></a>.
In particular, after installing the TauDEM CLI and dependencies as well
as the R package, please run <code><a href="https://lucarraro.github.io/traudem/reference/taudem_sitrep.html" class="external-link">traudem::taudem_sitrep()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">traudem</span><span class="fu">::</span><span class="fu"><a href="https://lucarraro.github.io/traudem/reference/taudem_sitrep.html" class="external-link">taudem_sitrep</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Found GDAL version 3.0.4.</span></span>
<span><span class="co">#&gt; ✔ Found mpiexec (OpenRTE) 4.0.3 (MPI).</span></span>
<span><span class="co">#&gt; ✔ Found TauDEM path (/usr/local/taudem).</span></span>
<span><span class="co">#&gt; ✔ Found TauDEM executables directory (/usr/local/taudem).</span></span>
<span><span class="co">#&gt; ✔ Found all TauDEM executables.</span></span>
<span><span class="co">#&gt; ℹ Testing TauDEM on an example file (please wait a bit)...</span></span>
<span><span class="co">#&gt; ── TauDEM output ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; PitRemove version 5.3.9</span></span>
<span><span class="co">#&gt; Input file DEM.tif has projected coordinate system.</span></span>
<span><span class="co">#&gt; Nodata value input to create partition from file: nan</span></span>
<span><span class="co">#&gt; Nodata value recast to float used in partition raster: nan</span></span>
<span><span class="co">#&gt; Processes: 1</span></span>
<span><span class="co">#&gt; Header read time: 0.008202</span></span>
<span><span class="co">#&gt; Data read time: 0.003174</span></span>
<span><span class="co">#&gt; Compute time: 0.028233</span></span>
<span><span class="co">#&gt; Write time: 0.002115</span></span>
<span><span class="co">#&gt; Total time: 0.041723</span></span>
<span><span class="co">#&gt; This run may take on the order of 1 minutes to complete.</span></span>
<span><span class="co">#&gt; This estimate is very approximate. </span></span>
<span><span class="co">#&gt; Run time is highly uncertain as it depends on the complexity of the input data </span></span>
<span><span class="co">#&gt; and speed and memory of the computer. This estimate is based on our testing on </span></span>
<span><span class="co">#&gt; a dual quad core Dell Xeon E5405 2.0GHz PC with 16GB RAM.</span></span>
<span><span class="co">#&gt; ── End of TauDEM output ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; ✔ Was able to launch a TauDEM example!</span></span>
<span><span class="co">#&gt; ! Double-check above output for serious error messages.</span></span></code></pre></div>
<p>You can install traudem from CRAN:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"traudem"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version of traudem from
R-universe:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Enable repository from lucarraro</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    lucarraro <span class="op">=</span> <span class="st">'https://lucarraro.r-universe.dev'</span>,</span>
<span>    CRAN <span class="op">=</span> <span class="st">'https://cloud.r-project.org'</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Download and install traudem in R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'traudem'</span><span class="op">)</span></span></code></pre></div>
<p>Or from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"lucarraro/traudem"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simple-example">Simple example<a class="anchor" aria-label="anchor" href="#simple-example"></a>
</h2>
<p>This is how you would use traudem to launch <a href="https://hydrology.usu.edu/taudem/taudem5/help53/PitRemove.html" class="external-link">TauDEM’s
PitRemove</a>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lucarraro.github.io/traudem/" class="external-link">traudem</a></span><span class="op">)</span></span>
<span><span class="va">test_dir</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">file_copy</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"test-data"</span>, <span class="st">"DEM.tif"</span>, package <span class="op">=</span> <span class="st">"traudem"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lucarraro.github.io/traudem/reference/taudem_pitremove.html" class="external-link">taudem_pitremove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; PitRemove version 5.3.9</span></span>
<span><span class="co">#&gt; Input file /tmp/Rtmp64HAv3/filefc9c38806e1b/DEM.tif has projected coordinate system.</span></span>
<span><span class="co">#&gt; Nodata value input to create partition from file: nan</span></span>
<span><span class="co">#&gt; Nodata value recast to float used in partition raster: nan</span></span>
<span><span class="co">#&gt; Processes: 1</span></span>
<span><span class="co">#&gt; Header read time: 0.002983</span></span>
<span><span class="co">#&gt; Data read time: 0.001157</span></span>
<span><span class="co">#&gt; Compute time: 0.016390</span></span>
<span><span class="co">#&gt; Write time: 0.001719</span></span>
<span><span class="co">#&gt; Total time: 0.022249</span></span>
<span><span class="co">#&gt; This run may take on the order of 1 minutes to complete.</span></span>
<span><span class="co">#&gt; This estimate is very approximate. </span></span>
<span><span class="co">#&gt; Run time is highly uncertain as it depends on the complexity of the input data </span></span>
<span><span class="co">#&gt; and speed and memory of the computer. This estimate is based on our testing on </span></span>
<span><span class="co">#&gt; a dual quad core Dell Xeon E5405 2.0GHz PC with 16GB RAM.</span></span>
<span><span class="va">output</span></span>
<span><span class="co">#&gt; [1] "/tmp/Rtmp64HAv3/filefc9c38806e1b/DEMfel.tif"</span></span></code></pre></div>
<p>We ran the example above in a temporary directory that
<code>withr</code> automatically deletes. If you want to automatically
get rid of some of the intermediary files created by TauDEM in one of
your pipelines, you might be interested in
<code><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">withr::local_tempfile()</a></code>.</p>
<p>If you wanted to run this same code without seeing the messages from
TauDEM, you can either use the <code>quiet</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_dir</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">file_copy</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"test-data"</span>, <span class="st">"DEM.tif"</span>, package <span class="op">=</span> <span class="st">"traudem"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lucarraro.github.io/traudem/reference/taudem_pitremove.html" class="external-link">taudem_pitremove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">output</span></span>
<span><span class="co">#&gt; [1] "/tmp/Rtmp64HAv3/filefc9c7b85bbf2/DEMfel.tif"</span></span></code></pre></div>
<p>Or set the <code>traudem.quiet</code> option
(<code>options(traudem.quiet = TRUE)</code> or for just the session,
<code>withr::local_options(traudem.quiet = TRUE)</code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="op">(</span>traudem.quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">test_dir</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_tempfile.html" class="external-link">local_tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">file_copy</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"test-data"</span>, <span class="st">"DEM.tif"</span>, package <span class="op">=</span> <span class="st">"traudem"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lucarraro.github.io/traudem/reference/taudem_pitremove.html" class="external-link">taudem_pitremove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">test_dir</span>, <span class="st">"DEM.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">output</span></span>
<span><span class="co">#&gt; [1] "/tmp/Rtmp64HAv3/filefc9c2c87ac26/DEMfel.tif"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-example-download-dem-data-and-extract-a-river-network">Full example: download DEM data and extract a river network<a class="anchor" aria-label="anchor" href="#full-example-download-dem-data-and-extract-a-river-network"></a>
</h2>
<p><code>traudem</code> can be used in combination with R-package <a href="https://cran.r-project.org/package=elevatr" class="external-link">elevatr</a> to extract
a river network from elevation data retrieved from the web.</p>
<p>The following example shows how to derive the contour of a catchment
and drainage area values for all cells within that contour by using the
<a href="https://hydrology.usu.edu/taudem/taudem5/help53/D8FlowDirections.html" class="external-link">D8
flow direction algorithm</a>.</p>
<p>The only required inputs are:</p>
<ul>
<li>coordinates of the catchment outlet;</li>
<li>coordinates of the lower-left and top-right corners of a rectangular
area containing the catchment of interest;</li>
<li>EPSG code corresponding to the projection used to express coordinate
data (see also <a href="https://epsg.org/home.html" class="external-link uri">https://epsg.org/home.html</a>);</li>
<li>zoom level at which the DEM data are extracted (see
<code>elevatr</code> <a href="https://cran.r-project.org/package=elevatr" class="external-link">documentation</a>).</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(elevatr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1; sf_use_s2() is TRUE</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; terra 1.6.17</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(traudem)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shapefiles)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loading required package: foreign</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attaching package: 'shapefiles'</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from 'package:foreign':</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     read.dbf, write.dbf</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(withr)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">taudem_sitrep</span>() <span class="co"># verify that TauDEM is correctly installed </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Found GDAL version 3.0.4.</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Found mpiexec (OpenRTE) 4.0.3 (MPI).</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Found TauDEM path (/usr/local/taudem).</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Found TauDEM executables directory (/usr/local/taudem).</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Found all TauDEM executables.</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Testing TauDEM on an example file (please wait a bit)...</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── TauDEM output ────────────────────────────────────────────────────────────────────</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; PitRemove version 5.3.9</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Input file DEM.tif has projected coordinate system.</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Nodata value input to create partition from file: nan</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Nodata value recast to float used in partition raster: nan</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Processes: 1</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Header read time: 0.002094</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data read time: 0.000788</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Compute time: 0.013749</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Write time: 0.001609</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total time: 0.018240</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This run may take on the order of 1 minutes to complete.</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This estimate is very approximate. </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Run time is highly uncertain as it depends on the complexity of the input data </span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; and speed and memory of the computer. This estimate is based on our testing on </span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a dual quad core Dell Xeon E5405 2.0GHz PC with 16GB RAM.</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── End of TauDEM output ─────────────────────────────────────────────────────────────</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Was able to launch a TauDEM example!</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Double-check above output for serious error messages.</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>test_dir <span class="ot">&lt;-</span> <span class="fu">local_tempdir</span>() <span class="co"># temporary directory storing intermediary files created by TauDEM</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Input data for the river Wigger (central Switzerland)</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>EPSG <span class="ot">&lt;-</span> <span class="dv">21781</span>   <span class="co"># EPSG code corresponding to CH1903 (Swiss projected coordinate system) </span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>x_outlet <span class="ot">&lt;-</span> <span class="dv">637478</span> <span class="co"># outlet x coordinate in CH1903 coordinates</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>y_outlet <span class="ot">&lt;-</span> <span class="dv">237413</span> <span class="co"># outlet y coordinate in CH1903 coordinates</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>x_ll <span class="ot">&lt;-</span> <span class="dv">620000</span> <span class="co"># x coordinate of the lower-left (SW) limit of the region</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>x_tr <span class="ot">&lt;-</span> <span class="dv">660000</span> <span class="co"># x coordinate of the top-right (NE) limit of the region </span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>y_ll <span class="ot">&lt;-</span> <span class="dv">200000</span> <span class="co"># y coordinate of the lower-left (SW) limit of the region    </span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>y_tr <span class="ot">&lt;-</span> <span class="dv">250000</span> <span class="co"># y coordinate of the top-right (NE) limit of the region</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>zoom <span class="ot">&lt;-</span> <span class="dv">9</span> <span class="co"># corresponds to cellsize ~= 100 m at the latitude of interest</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co"># use elevatr to download DEM </span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>loc.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">c</span>(x_ll, x_tr), <span class="at">y=</span><span class="fu">c</span>(y_ll,y_tr))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">rast</span>()</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(r) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"epsg:"</span>, EPSG)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>crs_str <span class="ot">&lt;-</span> <span class="fu">crs</span>(r)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">get_elev_raster</span>(<span class="at">locations =</span> loc.df, <span class="at">prj =</span> crs_str, <span class="at">z =</span> zoom, <span class="at">verbose =</span> F) </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO", prefer_proj = prefer_proj): PROJ/GDAL PROJ string degradation in workflow</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  repeated warnings suppressed</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Discarded datum CH1903 in Proj4 definition</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Accessing raster elevation [-------------------------]   0%</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a> Accessing raster elevation [<span class="sc">==</span><span class="er">===&gt;</span><span class="sc">-------------------</span>]  <span class="dv">25</span>%</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a> Accessing raster elevation [<span class="sc">==</span><span class="er">=========&gt;</span><span class="sc">-------------</span>]  <span class="dv">50</span>%</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a> Accessing raster elevation [<span class="sc">==</span><span class="er">================&gt;</span><span class="sc">------</span>]  <span class="dv">75</span>%</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a> Accessing raster elevation [<span class="sc">==</span><span class="er">=======================</span>] <span class="dv">100</span>%</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mosaicing &amp; Projecting</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rast</span>(z)</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">crop</span>(z, <span class="fu">ext</span>(x_ll, x_tr, y_ll, y_tr))</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify: all pixels with elev=NA are set to 0. Then the pit remove algorithm will take care of them</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">classify</span>(z, <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">0</span>), <span class="dv">1</span>, <span class="dv">3</span>)) </span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(z, <span class="at">filename =</span> <span class="fu">file.path</span>(test_dir, <span class="st">"DEM.tif"</span>)) <span class="co"># write elevation raster to temporary directory</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a><span class="co"># apply TauDEM functions</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove pits</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>out_fel <span class="ot">&lt;-</span> <span class="fu">taudem_pitremove</span>(<span class="fu">file.path</span>(test_dir, <span class="st">"DEM.tif"</span>), <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="co"># D8 flow directions</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>out_p <span class="ot">&lt;-</span> <span class="fu">taudem_d8flowdir</span>(out_fel, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>out_p <span class="ot">&lt;-</span> out_p<span class="sc">$</span>output_d8flowdir_grid <span class="co"># file path of flow direction file</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Contributing area</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>out_ad8 <span class="ot">&lt;-</span> <span class="fu">taudem_aread8</span>(out_p, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Threshold</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>out_src <span class="ot">&lt;-</span> <span class="fu">taudem_threshold</span>(out_ad8, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="co"># create shapefile with approximate outlet location</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>shp.point <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">sname =</span> <span class="st">"shape"</span>){ <span class="co"># function to create point shapefile given coordinates </span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Id =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">X =</span> x, <span class="at">Y =</span> y)</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  ddTable <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Id =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">Name =</span> <span class="fu">paste</span>(<span class="st">"Outlet"</span>, <span class="dv">1</span><span class="sc">:</span>n, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>  ddShapefile <span class="ot">&lt;-</span> <span class="fu">convert.to.shapefile</span>(dd, ddTable, <span class="st">"Id"</span>, <span class="dv">1</span>)</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.shapefile</span>(ddShapefile, sname, <span class="at">arcgis =</span> T)</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">paste0</span>(sname,<span class="st">".shp"</span>))</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>out_shp <span class="ot">&lt;-</span>  <span class="fu">shp.point</span>(x_outlet, y_outlet, <span class="fu">file.path</span>(test_dir, <span class="st">"ApproxOutlet"</span>))</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Move outlet to stream</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>out_moved.shp <span class="ot">&lt;-</span> <span class="fu">taudem_moveoutletstostream</span>(out_p, out_src, <span class="at">outlet_file =</span> out_shp, </span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">output_moved_outlets_file =</span> <span class="fu">file.path</span>(test_dir, <span class="st">"Outlet.shp"</span>), </span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Contributing area upstream of outlet</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>out_ssa <span class="ot">&lt;-</span> <span class="fu">taudem_aread8</span>(out_p, <span class="at">outlet_file =</span> out_moved.shp, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive catchment contour</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>ssa <span class="ot">&lt;-</span> <span class="fu">rast</span>(out_ssa)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify: pixels within the catchment have value 1, others 0</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>ssa_cont <span class="ot">&lt;-</span> <span class="fu">classify</span>(ssa, <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="cn">Inf</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="at">byrow =</span> T)) </span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="co"># plot DEM of the region and catchment contours</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(z, <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">1000</span>), <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1200</span>))</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(ssa_cont, <span class="at">add =</span> T, <span class="at">labels =</span> <span class="st">""</span>) </span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"DEM and catchment contour"</span>)</span></code></pre></div>
<p><img src="traudem-unnamed-chunk-8-1.png" alt=" Plot of the catchment contour of the river Wigger (Switzerland) extracted from a DEM via traudem."></p>
<pre><code><span><span class="co"># plot map of drainage area within the catchment</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">ssa</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="st">"viridis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Drainage area [no. cells]"</span><span class="op">)</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total catchment area </span></span>
<span><span class="va">ssa_log</span> <span class="op">&lt;-</span> <span class="va">ssa</span></span>
<span><span class="fu">values</span><span class="op">(</span><span class="va">ssa_log</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">ssa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">ssa_log</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="st">"viridis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Drainage area [log10(no. cells)]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="traudem-unnamed-chunk-9-1.png" alt="Plot of log-scaled drainage area values for DEM pixels within the catchment. The use of a log-scale highlights the shape of the underlying river network."></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cellsize</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu">res</span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># cellsize is geometric mean of downloaded raster resolution</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu">values</span><span class="op">(</span><span class="va">ssa</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">*</span><span class="va">cellsize</span><span class="op">^</span><span class="fl">2</span> <span class="co"># total catchment area in m^2</span></span>
<span><span class="co">#&gt; [1] 363822337</span></span></code></pre></div>
<p>The total area of the extracted catchment is 364 km<sup>2</sup>.</p>
</div>
<div class="section level2">
<h2 id="what-should-i-do-if-i-do-not-retrieve-the-desired-catchment">What should I do if I do not retrieve the desired catchment?<a class="anchor" aria-label="anchor" href="#what-should-i-do-if-i-do-not-retrieve-the-desired-catchment"></a>
</h2>
<p>It might happen that, even when the coordinates of the catchment
outlet are precisely attributed, the obtained catchment shape is not the
desired one (in particular, much smaller than the sought one). This
might be due to issues in determining the correct outlet position in the
extracted river network. In fact, the outlet position is moved downslope
from the initial, user-specified location
<code>(x_outlet, y_outlet)</code> to the closest stream cell via
function <code>taudem_moveoutletstostream</code>. Depending on the
terrain topography and the DEM resolution, the extracted river network
might not overlap exactly with real river networks, hence the possible
errors.</p>
<p>To solve this issue, it is suggested to:</p>
<ul>
<li>Slightly change the coordinates <code>x_outlet</code>,
<code>y_outlet</code>, to better align the input outlet location with
the extracted stream cells.</li>
<li>Change argument <code>threshold_parameter</code> in
<code>taudem_threshold</code>. Stream cells are defined as cells with
drainage area not smaller than <code>threshold_parameter</code>
(expressed in number of cells). If <code>threshold_parameter</code> is
too large, the actual outlet location will be moved too far away in the
downstream direction; if too small, the actual outlet location will not
be moved enough in the downstream direction.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Luca Carraro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
